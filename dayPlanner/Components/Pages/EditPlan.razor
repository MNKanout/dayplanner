@page "/edit-plan"
@using dayPlanner.Data.Entities
@rendermode InteractiveServer

<PageTitle>Create Your Amazing Day Plan! âœ¨</PageTitle>

<div class="edit-plan-page">
    <h1>âœ¨ Create Your Amazing Day Plan! âœ¨</h1>
    <p class="page-subtitle">Let's plan your day together! You can add all the fun activities you'll do.</p>
    
    <div class="date-selector mb-4">
        <label for="date-picker" class="form-label">ğŸ“… Pick a Date:</label>
        <input type="date" 
               id="date-picker" 
               class="form-control" 
               @bind="selectedDate" 
               @bind:format="yyyy-MM-dd"
               @bind:after="LoadPlanForDate" />
    </div>

    @if (plan == null)
    {
        <div class="no-plan-message">
            <div class="message-icon">ğŸ“‹</div>
            <p class="message-title">No plan found for this date.</p>
            <p class="message-text">That's okay! Let's create a brand new plan together!</p>
            <button class="btn btn-primary btn-large" @onclick="CreateNewPlan">
                <span class="btn-icon">âœ¨</span>
                <span class="btn-text">Create New Plan</span>
            </button>
        </div>
    }
    else
    {
        <div class="plan-header mb-4">
            <label for="plan-title" class="form-label">ğŸ“ Give Your Plan a Name (optional):</label>
            <input type="text" 
                   id="plan-title" 
                   class="form-control" 
                   @bind="plan.Title" 
                   @bind:event="oninput"
                   @onblur="SavePlanTitle"
                   placeholder="e.g., School Day, Weekend Adventure, Fun Friday" />
        </div>

        <div class="activities-section">
            <h2>ğŸ¯ Your Activities</h2>
            
            @if (!plan.Activities.Any())
            {
                <p class="text-muted friendly-text">No activities yet. Ready to add your first one? Let's do it! ğŸš€</p>
            }
            else
            {
                <p class="friendly-text">Look at all your activities! You're doing great! ğŸŒŸ</p>
                <div class="activities-list">
                    @{
                        var orderedActivities = plan.Activities.OrderBy(a => a.Order).ToList();
                    }
                    @for (int i = 0; i < orderedActivities.Count; i++)
                    {
                        var activity = orderedActivities[i];
                        var isFirst = i == 0;
                        var isLast = i == orderedActivities.Count - 1;
                        
                        <div class="activity-item" key="@activity.Id">
                            @if (editingActivityId == activity.Id)
                            {
                                <EditActivityForm 
                                    Activity="activity"
                                    OnSave="HandleSaveActivity"
                                    OnCancel="HandleCancelEdit" />
                            }
                            else
                            {
                                <ActivityItemDisplay 
                                    Activity="activity"
                                    IsFirst="isFirst"
                                    IsLast="isLast"
                                    OnEdit="HandleEditActivity"
                                    OnDelete="HandleDeleteActivity"
                                    OnMoveUp="HandleMoveUp"
                                    OnMoveDown="HandleMoveDown" />
                            }
                        </div>
                    }
                </div>
            }

            @if (isAddingNew)
            {
                <NewActivityForm 
                    OnSave="HandleAddActivity"
                    OnCancel="HandleCancelAdd" />
            }
            else
            {
                <button class="btn btn-success mt-3 btn-add-activity" @onclick="StartAddingNew">
                    <span class="btn-icon">â•</span>
                    <span class="btn-text">Add New Activity</span>
                </button>
            }
        </div>
    }
</div>

